static const char CONTENT_HOME_JS[] PROGMEM = 
  "\"use strict\";function OpenEVSEError(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:\"\";this.type=e,this.message=n}function OpenEVSERequest(){var n=this;n._done=function(){},n._error=function(){},n._always=function(){},n.done=function(e){return n._done=e,n},n.error=function(e){return n._error=e,n},n.always=function(e){return n._always=e,n}}function OpenEVSE(e){var f=this;f._version=\"0.1\",f._endpoint=e,f.states={0:\"unknown\",1:\"not connected\",2:\"connected\",3:\"charging\",4:\"vent required\",5:\"diode check failed\",6:\"gfci fault\",7:\"no ground\",8:\"stuck relay\",9:\"gfci self-test failure\",10:\"over temperature\",11:\"over current\",254:\"sleeping\",255:\"disabled\"},f._lcd_colors=[\"off\",\"red\",\"green\",\"yellow\",\"blue\",\"violet\",\"teal\",\"white\"],f._status_functions={disable:\"FD\",enable:\"FE\",sleep:\"FS\"},f._lcd_types=[\"monochrome\",\"rgb\"],f._service_levels=[\"A\",\"1\",\"2\"],f.STANDARD_SERIAL_TIMEOUT=.5,f.RESET_SERIAL_TIMEOUT=10,f.STATUS_SERIAL_TIMEOUT=0,f.SYNC_SERIAL_TIMEOUT=.5,f.NEWLINE_MAX_AGE=5,f.CORRECT_RESPONSE_PREFIXES=\"$NK\",f.regex=/\\$([^^]*)(\\^..)?/,f._request=function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){},e=\"$\"+(Array.isArray(e)?e.join(\"+\"):e),t=new OpenEVSERequest;return $.get(f._endpoint+\"?json=1&rapi=\"+encodeURI(e),function(e){e=e.ret.match(f.regex);null!==e?\"OK\"===(e=e[1].split(\" \"))[0]?(n(e.slice(1)),t._done(e.slice(1))):t._error(new OpenEVSEError(\"OperationFailed\")):t._error(new OpenEVSEError(\"UnexpectedResponse\"))},\"json\").always(function(){t._always()}).fail(function(){t._error(new OpenEVSEError(\"RequestFailed\"))}),t},f._flags=function(t){var s=f._request(\"GE\",function(e){var n=parseInt(e[1],16);isNaN(n)?s._error(new OpenEVSEError(\"ParseError\",'Failed to parse \"'+e[0]+'\"')):t({service_level:1+(1&n),diode_check:0==(2&n),vent_required:0==(4&n),ground_check:0==(8&n),stuck_relay_check:0==(16&n),auto_service_level:0==(32&n),auto_start:0==(64&n),serial_debug:0!=(128&n),lcd_type:0!=(256&n)?\"monochrome\":\"rgb\",gfi_self_test:0==(512&n),temp_check:0==(1024&n)})});return s},f.reset=function(){return f._request(\"FR\")},f.time=function(i){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(!1!==e)return f._request([\"S1\",e.getFullYear()-2e3,e.getMonth()+1,e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds()],function(){f.time(i)});var l=f._request(\"GT\",function(e){var n,t,s,o,r,a;6<=e.length?(n=parseInt(e[0]),t=parseInt(e[1]),s=parseInt(e[2]),o=parseInt(e[3]),r=parseInt(e[4]),a=parseInt(e[5]),isNaN(n)||isNaN(t)||isNaN(s)||isNaN(o)||isNaN(r)||isNaN(a)?l._error(new OpenEVSEError(\"ParseError\",'Could not parse time \"'+e.join(\" \")+'\" arguments')):165==n&&165==t&&165==s&&165==o&&165==r&&85==a?i(new Date(0),!1):(a=new Date(2e3+n,t-1,s,o,r,a),i(a,!0))):l._error(new OpenEVSEError(\"ParseError\",\"Only received \"+e.length+\" arguments\"))});return l},f.timer=function(r){var a=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=2<arguments.length&&void 0!==arguments[2]&&arguments[2];function l(e){return(e<10?\"0\":\"\")+e}if(!1!==a&&!1!==i){var e=/([01]\\d|2[0-3]):([0-5]\\d)/,n=a.match(e),e=i.match(e);return null!==n&&null!==e?f._request([\"ST\",parseInt(n[1]),parseInt(n[2]),parseInt(e[1]),parseInt(e[2])],function(){f.timer(r)}):!1}var c=f._request(\"GD\",function(e){var n,t,s,o;4<=e.length?(n=parseInt(e[0]),t=parseInt(e[1]),s=parseInt(e[2]),o=parseInt(e[3]),isNaN(n)||isNaN(t)||isNaN(s)||isNaN(o)?c._error(new OpenEVSEError(\"ParseError\",'Could not parse time \"'+e.join(\" \")+'\" arguments')):0===n&&0===t&&0===s&&0===o?r(!1,\"--:--\",\"--:--\"):(a=l(n)+\":\"+l(t),i=l(s)+\":\"+l(o),r(!0,a,i))):c._error(new OpenEVSEError(\"ParseError\",\"Only received \"+e.length+\" arguments\"))});return c},f.cancelTimer=function(e){return f._request([\"ST\",0,0,0,0],function(){e()})},f.time_limit=function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(!1!==e)return f._request([\"S3\",Math.round(e/15)],function(){f.time_limit(t)});var s=f._request(\"G3\",function(e){var n;1<=e.length?(n=parseInt(e[0]),isNaN(n)?s._error(new OpenEVSEError(\"ParseError\",'Could not parse \"'+e.join(\" \")+'\" arguments')):t(15*n)):s._error(new OpenEVSEError(\"ParseError\",\"Only received \"+e.length+\" arguments\"))});return s},f.charge_limit=function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(!1!==e)return f._request([\"SH\",e],function(){f.charge_limit(t)});var s=f._request(\"GH\",function(e){var n;1<=e.length?(n=parseInt(e[0]),isNaN(n)?s._error(new OpenEVSEError(\"ParseError\",'Could not parse \"'+e.join(\" \")+'\" arguments')):t(n)):s._error(new OpenEVSEError(\"ParseError\",\"Only received \"+e.length+\" arguments\"))});return s},f.ammeter_settings=function(s){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(!1!==e&&!1!==n)return f._request([\"SA\",e,n],function(){s(e,n)});var o=f._request(\"GA\",function(e){var n,t;2<=e.length?(n=parseInt(e[0]),t=parseInt(e[1]),isNaN(n)||isNaN(t)?o._error(new OpenEVSEError(\"ParseError\",'Could not parse \"'+e.join(\" \")+'\" arguments')):s(n,t)):o._error(new OpenEVSEError(\"ParseError\",\"Only received \"+e.length+\" arguments\"))});return o},f.current_capacity=function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(!1!==e)return f._request([\"SC\",e],function(){f.current_capacity(t)});var s=f._request(\"GE\",function(e){var n;1<=e.length?(n=parseInt(e[0]),isNaN(n)?s._error(new OpenEVSEError(\"ParseError\",'Could not parse \"'+e.join(\" \")+'\" arguments')):t(n)):s._error(new OpenEVSEError(\"ParseError\",\"Only received \"+e.length+\" arguments\"))});return s},f.service_level=function(n){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return!1!==e?f._request([\"SL\",f._service_levels[e]],function(){f.service_level(n)}):f._flags(function(e){n(e.auto_service_level?0:e.service_level,e.service_level)})},f.current_capacity_range=function(s){var o=f._request(\"GC\",function(e){var n,t;2<=e.length?(n=parseInt(e[0]),t=parseInt(e[1]),isNaN(n)||isNaN(t)?o._error(new OpenEVSEError(\"ParseError\",'Could not parse \"'+e.join(\" \")+'\" arguments')):s(n,t)):o._error(new OpenEVSEError(\"ParseError\",\"Only received \"+e.length+\" arguments\"))});return o},f.status=function(s){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(!1!==e){e=f._status_functions[e];return f._request([e],function(){f.status(s)})}var o=f._request(\"GS\",function(e){var n,t;1<=e.length?(n=parseInt(e[0]),t=parseInt(e[1]),isNaN(n)||isNaN(t)?o._error(new OpenEVSEError(\"ParseError\",'Could not parse \"'+e.join(\" \")+'\" arguments')):s(n,t)):o._error(new OpenEVSEError(\"ParseError\",\"Only received \"+e.length+\" arguments\"))});return o},f.diode_check=function(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return null!==e?f._request([\"FF\",\"D\",e?\"1\":\"0\"],function(){f.diode_check(n)}):f._flags(function(e){n(e.diode_check)})},f.gfi_self_test=function(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return null!==e?f._request([\"FF F\",e?\"1\":\"0\"],function(){f.gfi_self_test(n)}):f._flags(function(e){n(e.gfi_self_test)})},f.ground_check=function(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return null!==e?f._request([\"FF G\",e?\"1\":\"0\"],function(){f.ground_check(n)}):f._flags(function(e){n(e.ground_check)})},f.stuck_relay_check=function(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return null!==e?f._request([\"FF R\",e?\"1\":\"0\"],function(){f.stuck_relay_check(n)}):f._flags(function(e){n(e.stuck_relay_check)})},f.vent_required=function(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return null!==e?f._request([\"FF V\",e?\"1\":\"0\"],function(){f.vent_required(n)}):f._flags(function(e){n(e.vent_required)})},f.temp_check=function(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return null!==e?f._request([\"FF T\",e?\"1\":\"0\"],function(){f.temp_check(n)}):f._flags(function(e){n(e.temp_check)})},f.over_temperature_thresholds=function(s){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(!1!==e&&!1!==n)return f._request([\"SO\",e,n],function(){f.over_temperature_thresholds(s)});var o=f._request(\"GO\",function(e){var n,t;2<=e.length?(n=parseInt(e[0]),t=parseInt(e[1]),isNaN(n)||isNaN(t)?o._error(new OpenEVSEError(\"ParseError\",'Could not parse \"'+e.join(\" \")+'\" arguments')):s(n,t)):o._error(new OpenEVSEError(\"ParseError\",\"Only received \"+e.length+\" arguments\"))});return o},f.press_button=function(e){return f._request(\"F1\",function(){e()})},f.setEndpoint=function(e){f._endpoint=e}}function RapiViewModel(e){var n=this;n.baseEndpoint=e,n.rapiSend=ko.observable(!1),n.cmd=ko.observable(\"\"),n.ret=ko.observable(\"\"),n.send=function(){n.rapiSend(!0),$.get(n.baseEndpoint()+\"/r?json=1&rapi=\"+encodeURI(n.cmd()),function(e){n.ret(\">\"+e.ret),n.cmd(e.cmd)},\"json\").always(function(){n.rapiSend(!1)})}}function TimeViewModel(t){var s=this;function o(e){return(e<10?\"0\":\"\")+e}s.evseTimedate=ko.observable(new Date),s.localTimedate=ko.observable(new Date),s.nowTimedate=ko.observable(null),s.hasRTC=ko.observable(!0),s.elapsedNow=ko.observable(new Date(0)),s.elapsedLocal=ko.observable(new Date),s.divertUpdateNow=ko.observable(new Date(0)),s.divertUpdateLocal=ko.observable(new Date),s.date=ko.pureComputed({read:function(){if(null===s.nowTimedate())return\"\";var e=s.nowTimedate();return e.getFullYear()+\"-\"+o(e.getMonth()+1)+\"-\"+o(e.getDate())},write:function(e){var n=s.evseTimedate();e+=\" \"+o(n.getHours())+\":\"+o(n.getMinutes())+\":\"+o(n.getSeconds()),s.evseTimedate(new Date(e)),s.localTimedate(new Date)}}),s.time=ko.pureComputed({read:function(){if(null===s.nowTimedate())return\"--:--:--\";var e=s.nowTimedate();return o(e.getHours())+\":\"+o(e.getMinutes())+\":\"+o(e.getSeconds())},write:function(e){var n=e.split(\":\"),e=s.evseTimedate();e.setHours(parseInt(n[0])),e.setMinutes(parseInt(n[1])),s.evseTimedate(e),s.localTimedate(new Date)}}),s.elapsed=ko.pureComputed(function(){if(null===s.nowTimedate())return\"0:00:00\";var e=s.elapsedNow().getTime(),n=(e=Math.floor(e/1e3))%60,t=(e=Math.floor(e/60))%60;return Math.floor(e/60)+\":\"+o(t)+\":\"+o(n)}),t.status.elapsed.subscribe(function(e){s.elapsedNow(new Date(1e3*e)),s.elapsedLocal(new Date)}),s.divert_update=ko.pureComputed(function(){if(null===s.nowTimedate())return!1;var e=s.divertUpdateNow().getTime();return Math.floor(e/1e3)}),t.status.divert_update.subscribe(function(e){s.divertUpdateNow(new Date(1e3*e)),s.divertUpdateLocal(new Date)});var r=null;s.automaticTime=ko.observable(!0),s.timeUpdate=function(e){var n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];s.hasRTC(n),null!==r&&(clearInterval(r),r=null),s.evseTimedate(e),s.nowTimedate(e),s.localTimedate(new Date),r=setInterval(function(){s.automaticTime()&&s.nowTimedate(new Date(s.evseTimedate().getTime()+(new Date-s.localTimedate()))),t.isCharging()&&s.elapsedNow(new Date(1e3*t.status.elapsed()+(new Date-s.elapsedLocal()))),s.divertUpdateNow(new Date(1e3*t.status.divert_update()+(new Date-s.divertUpdateLocal())))},1e3)}}function TimeZoneViewModel(e){this.name=ko.observable(e.name),this.value=ko.observable(e.name+\"|\"+e.tz)}function ZonesViewModel(e){var s=this,n=ko.pureComputed(function(){return e()+\"/zones.json\"});s.fetching=ko.observable(!1),s.zones=ko.mapping.fromJS([],{key:function(e){return ko.utils.unwrapObservable(e.name)},create:function(e){return new TimeZoneViewModel(e.data)}}),s.initialValue=function(e){e=e.split(\"|\",2);2==e.length?s.zones.push(new TimeZoneViewModel({name:e[0],tz:e[1]})):s.zones.push(new TimeZoneViewModel({name:\"Default\",tz:e[1]}))},s.update=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){};s.fetching(!0),$.get(n(),function(e){var n,t=[];for(n in e)e.hasOwnProperty(n)&&t.push({name:n,tz:e[n]});ko.mapping.fromJS(t,s.zones)},\"json\").always(function(){s.fetching(!1),e()})}}function DummyRequest(){var n=this;n.always=function(e){return e(),n}}function OpenEvseViewModel(e,n,t){var s=this,o=ko.pureComputed(function(){return e()+\"/r\"});s.openevse=new OpenEVSE(o()),o.subscribe(function(e){s.openevse.setEndpoint(e)}),s.status=t,s.config=n,s.time=new TimeViewModel(s),s.serviceLevels=[{name:\"Auto\",value:0},{name:\"1\",value:1},{name:\"2\",value:2}],s.currentLevels=ko.observableArray([]),s.timeLimits=[{name:\"none\",value:0},{name:\"15 min\",value:15},{name:\"30 min\",value:30},{name:\"45 min\",value:45},{name:\"1 hour\",value:60},{name:\"1.5 hours\",value:90},{name:\"2 hours\",value:120},{name:\"2.5 hours\",value:150},{name:\"3 hours\",value:180},{name:\"4 hours\",value:240},{name:\"5 hours\",value:300},{name:\"6 hours\",value:360},{name:\"7 hours\",value:420},{name:\"8 hours\",value:480}],s.chargeLimits=[{name:\"none\",value:0},{name:\"1 kWh\",value:1},{name:\"2 kWh\",value:2},{name:\"3 kWh\",value:3},{name:\"4 kWh\",value:4},{name:\"5 kWh\",value:5},{name:\"6 kWh\",value:6},{name:\"7 kWh\",value:7},{name:\"8 kWh\",value:8},{name:\"9 kWh\",value:9},{name:\"10 kWh\",value:10},{name:\"15 kWh\",value:11},{name:\"20 kWh\",value:12},{name:\"25 kWh\",value:25},{name:\"30 kWh\",value:30},{name:\"35 kWh\",value:35},{name:\"40 kWh\",value:40},{name:\"45 kWh\",value:45},{name:\"50 kWh\",value:50},{name:\"55 kWh\",value:55},{name:\"60 kWh\",value:60},{name:\"70 kWh\",value:70},{name:\"80 kWh\",value:80},{name:\"90 kWh\",value:90}],s.serviceLevel=ko.observable(-1),s.actualServiceLevel=ko.observable(-1),s.minCurrentLevel=ko.observable(-1),s.maxCurrentLevel=ko.observable(-1),s.currentCapacity=ko.observable(-1),s.timeLimit=ko.observable(-1),s.chargeLimit=ko.observable(-1),s.delayTimerEnabled=ko.observable(!1),s.delayTimerStart=ko.observable(\"--:--\"),s.delayTimerStop=ko.observable(\"--:--\"),s.gfiSelfTestEnabled=ko.observable(!1),s.groundCheckEnabled=ko.observable(!1),s.stuckRelayEnabled=ko.observable(!1),s.tempCheckEnabled=ko.observable(!1),s.diodeCheckEnabled=ko.observable(!1),s.ventRequiredEnabled=ko.observable(!1),s.allTestsEnabled=ko.pureComputed(function(){return s.gfiSelfTestEnabled()&&s.groundCheckEnabled()&&s.stuckRelayEnabled()&&s.tempCheckEnabled()&&s.diodeCheckEnabled()&&s.ventRequiredEnabled()}),s.tempCheckSupported=ko.observable(!1),s.isConnected=ko.pureComputed(function(){return-1!==[2,3].indexOf(s.status.state())}),s.isReady=ko.pureComputed(function(){return-1!==[0,1].indexOf(s.status.state())}),s.isCharging=ko.pureComputed(function(){return 3===s.status.state()}),s.isError=ko.pureComputed(function(){return-1!==[4,5,6,7,8,9,10,11].indexOf(s.status.state())}),s.isEnabled=ko.pureComputed(function(){return-1!==[0,1,2,3].indexOf(s.status.state())}),s.isSleeping=ko.pureComputed(function(){return 254===s.status.state()}),s.isDisabled=ko.pureComputed(function(){return 255===s.status.state()}),s.isPaused=ko.pureComputed(function(){return-1!==[254,255].indexOf(s.status.state())}),s.selectTimeLimit=function(e){if(s.timeLimit()!==e)for(var n=0;n<s.timeLimits.length;n++){var t=s.timeLimits[n];if(t.value>=e){s.timeLimit(t.value);break}}},s.selectChargeLimit=function(e){if(s.chargeLimit()!==e)for(var n=0;n<s.chargeLimits.length;n++){var t=s.chargeLimits[n];if(t.value>=e){s.chargeLimit(t.value);break}}};var r=[function(){return!1===s.status.time()?s.openevse.time(s.time.timeUpdate):new DummyRequest},function(){return s.openevse.service_level(function(e,n){s.serviceLevel(e),s.actualServiceLevel(n)})},function(){return s.updateCurrentCapacity()},function(){return s.openevse.current_capacity(function(e){s.currentCapacity(e)})},function(){return s.openevse.time_limit(function(e){s.selectTimeLimit(e)})},function(){return s.openevse.charge_limit(function(e){s.selectChargeLimit(e)})},function(){return s.openevse.gfi_self_test(function(e){s.gfiSelfTestEnabled(e)})},function(){return s.openevse.ground_check(function(e){s.groundCheckEnabled(e)})},function(){return s.openevse.stuck_relay_check(function(e){s.stuckRelayEnabled(e)})},function(){return s.openevse.temp_check(function(e){s.tempCheckEnabled(e)})},function(){return s.openevse.diode_check(function(e){s.diodeCheckEnabled(e)})},function(){return s.openevse.vent_required(function(e){s.ventRequiredEnabled(e)})},function(){return s.openevse.temp_check(function(){s.tempCheckSupported(!0)},s.tempCheckEnabled()).error(function(){s.tempCheckSupported(!1)})},function(){return s.openevse.timer(function(e,n,t){s.delayTimerEnabled(e),s.delayTimerStart(n),s.delayTimerStop(t)})}];s.updateCount=ko.observable(0),s.updateTotal=ko.observable(r.length),s.updateCurrentCapacity=function(){return s.openevse.current_capacity_range(function(e,n){s.minCurrentLevel(e),s.maxCurrentLevel(n);n=s.currentCapacity();s.currentLevels.removeAll();for(var t=s.minCurrentLevel();t<=s.maxCurrentLevel();t++)s.currentLevels.push({name:t+\" A\",value:t});s.currentCapacity(n)})},s.updatingServiceLevel=ko.observable(!1),s.savedServiceLevel=ko.observable(!1),s.updatingCurrentCapacity=ko.observable(!1),s.savedCurrentCapacity=ko.observable(!1),s.updatingTimeLimit=ko.observable(!1),s.savedTimeLimit=ko.observable(!1),s.updatingChargeLimit=ko.observable(!1),s.savedChargeLimit=ko.observable(!1),s.updatingDelayTimer=ko.observable(!1),s.savedDelayTimer=ko.observable(!1),s.updatingStatus=ko.observable(!1),s.savedStatus=ko.observable(!1),s.updatingGfiSelfTestEnabled=ko.observable(!1),s.savedGfiSelfTestEnabled=ko.observable(!1),s.updatingGroundCheckEnabled=ko.observable(!1),s.savedGroundCheckEnabled=ko.observable(!1),s.updatingStuckRelayEnabled=ko.observable(!1),s.savedStuckRelayEnabled=ko.observable(!1),s.updatingTempCheckEnabled=ko.observable(!1),s.savedTempCheckEnabled=ko.observable(!1),s.updatingDiodeCheckEnabled=ko.observable(!1),s.savedDiodeCheckEnabled=ko.observable(!1),s.updatingVentRequiredEnabled=ko.observable(!1),s.savedVentRequiredEnabled=ko.observable(!1);var a=!(s.setForTime=function(e,n){e(!0),setTimeout(function(){e(!1)},n)});function i(e){return/([01]\\d|2[0-3]):([0-5]\\d)/.test(e)}s.subscribe=function(){a||(s.serviceLevel.subscribe(function(e){s.updatingServiceLevel(!0),s.openevse.service_level(function(e,n){s.setForTime(s.savedServiceLevel,2e3),s.actualServiceLevel(n),s.updateCurrentCapacity().always(function(){})},e).always(function(){s.updatingServiceLevel(!1)})}),s.currentCapacity.subscribe(function(n){!0!==s.updatingServiceLevel()&&(s.updatingCurrentCapacity(!0),s.openevse.current_capacity(function(e){s.setForTime(s.savedCurrentCapacity,2e3),n!==e&&s.currentCapacity(e)},n).always(function(){s.updatingCurrentCapacity(!1)}))}),s.timeLimit.subscribe(function(n){s.updatingTimeLimit(!0),s.openevse.time_limit(function(e){s.setForTime(s.savedTimeLimit,2e3),n!==e&&s.selectTimeLimit(e)},n).always(function(){s.updatingTimeLimit(!1)})}),s.chargeLimit.subscribe(function(n){s.updatingChargeLimit(!0),s.openevse.charge_limit(function(e){s.setForTime(s.savedChargeLimit,2e3),n!==e&&s.selectChargeLimit(e)},n).always(function(){s.updatingChargeLimit(!1)})}),s.gfiSelfTestEnabled.subscribe(function(n){s.updatingGfiSelfTestEnabled(!0),s.openevse.gfi_self_test(function(e){s.setForTime(s.savedGfiSelfTestEnabled,2e3),n!==e&&s.gfiSelfTestEnabled(e)},n).always(function(){s.updatingGfiSelfTestEnabled(!1)})}),s.groundCheckEnabled.subscribe(function(n){s.updatingGroundCheckEnabled(!0),s.openevse.ground_check(function(e){s.setForTime(s.savedGroundCheckEnabled,2e3),n!==e&&s.groundCheckEnabled(e)},n).always(function(){s.updatingGroundCheckEnabled(!1)})}),s.stuckRelayEnabled.subscribe(function(n){s.updatingStuckRelayEnabled(!0),s.savedStuckRelayEnabled(!1),s.openevse.stuck_relay_check(function(e){s.savedStuckRelayEnabled(!0),setTimeout(function(){s.savedStuckRelayEnabled(!1)},2e3),n!==e&&s.stuckRelayEnabled(e)},n).always(function(){s.updatingStuckRelayEnabled(!1)})}),s.tempCheckEnabled.subscribe(function(n){s.updatingTempCheckEnabled(!0),s.openevse.temp_check(function(e){s.setForTime(s.savedTempCheckEnabled,2e3),n!==e&&s.tempCheckEnabled(e)},n).always(function(){s.updatingTempCheckEnabled(!1)})}),s.diodeCheckEnabled.subscribe(function(n){s.updatingDiodeCheckEnabled(!0),s.openevse.diode_check(function(e){s.setForTime(s.savedDiodeCheckEnabled,2e3),n!==e&&s.diodeCheckEnabled(e)},n).always(function(){s.updatingDiodeCheckEnabled(!1)})}),s.ventRequiredEnabled.subscribe(function(n){s.updatingVentRequiredEnabled(!0),s.openevse.vent_required(function(e){s.setForTime(s.savedVentRequiredEnabled,2e3),n!==e&&s.ventRequiredEnabled(e)},n).always(function(){s.updatingVentRequiredEnabled(!1)})}),a=!0)},s.update=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){};s.updateCount(0),s.nextUpdate(e)},s.nextUpdate=function(e){(0,r[s.updateCount()])().always(function(){s.updateCount(s.updateCount()+1),s.updateCount()<r.length?s.nextUpdate(e):(s.subscribe(),e())})},s.delayTimerValid=ko.pureComputed(function(){return i(s.delayTimerStart())&&i(s.delayTimerStop())}),s.startDelayTimer=function(){s.updatingDelayTimer(!0),s.openevse.timer(function(){s.delayTimerEnabled(!0)},s.delayTimerStart(),s.delayTimerStop()).always(function(){s.updatingDelayTimer(!1)})},s.stopDelayTimer=function(){s.updatingDelayTimer(!0),s.openevse.cancelTimer(function(){s.delayTimerEnabled(!1)}).always(function(){s.updatingDelayTimer(!1)})},s.setStatus=function(e){\"pause\"===e&&(e=s.config.pause_uses_disabled()?\"disable\":\"sleep\");var n=s.status.state();\"disable\"===e&&255===n||\"sleep\"===e&&254===n||\"enable\"===e&&n<254||(s.updatingStatus(!0),!s.delayTimerEnabled()||\"sleep\"!==e&&\"enable\"!==e?s.openevse.status(function(e){s.status.state(e)},e).always(function(){s.updatingStatus(!1)}):s.openevse.press_button(function(){e=!1}).always(function(){s.openevse.status(function(e){s.status.state(e)},e).always(function(){s.updatingStatus(!1)})}))},s.restartFetching=ko.observable(!1),s.restart=function(){confirm(\"Restart OpenEVSE? Current config will be saved, takes approximately 10s.\")&&(s.restartFetching(!0),s.openevse.reset().always(function(){s.restartFetching(!1)}))}}function OpenEvseWiFiViewModel(baseHost,basePort,baseProtocol){var self=this;self.baseHost=ko.observable(\"\"!==baseHost?baseHost:\"openevse.local\"),self.basePort=ko.observable(basePort),self.baseProtocol=ko.observable(baseProtocol),self.baseEndpoint=ko.pureComputed(function(){var e=\"//\"+self.baseHost();return 80!==self.basePort()&&(e+=\":\"+self.basePort()),e}),self.wsEndpoint=ko.pureComputed(function(){var e=\"ws://\"+self.baseHost();return\"https:\"===self.baseProtocol()&&(e=\"wss://\"+self.baseHost()),80!==self.basePort()&&(e+=\":\"+self.basePort()),e+=\"/ws\"}),self.config=new ConfigViewModel(self.baseEndpoint),self.status=new StatusViewModel(self.baseEndpoint),self.rapi=new RapiViewModel(self.baseEndpoint),self.scan=new WiFiScanViewModel(self.baseEndpoint),self.wifi=new WiFiConfigViewModel(self.baseEndpoint,self.config,self.status,self.scan),self.openevse=new OpenEvseViewModel(self.baseEndpoint,self.config,self.status),self.zones=new ZonesViewModel(self.baseEndpoint),self.rfid=new RFIDViewModel(self.baseEndpoint),self.initialised=ko.observable(!1),self.updating=ko.observable(!1),self.scanUpdating=ko.observable(!1),self.wifi.selectedNet.subscribe(function(e){!1!==e&&self.config.ssid(e.ssid())}),self.config.ssid.subscribe(function(e){self.wifi.setSsid(e)}),self.showMqttInfo=ko.observable(!1),self.showSolarDivert=ko.observable(!1),self.showSafety=ko.observable(!1),self.showVehiclePauseStatus=ko.observable(!1),self.showTotalCurrentInfo=ko.observable(!1),self.toggle=function(e){e(!e())},self.advancedMode=ko.observable(!1),self.advancedMode.subscribe(function(e){self.setCookie(\"advancedMode\",e.toString())}),self.developerMode=ko.observable(!1),self.developerMode.subscribe(function(e){self.setCookie(\"developerMode\",e.toString()),e&&self.advancedMode(!0)}),self.sleepTimerNotConnectedEnabled=ko.computed({read:function(){return 1==(1&self.config.sleep_timer_enabled_flags())},write:function(e){e?self.config.sleep_timer_enabled_flags(1|self.config.sleep_timer_enabled_flags()):self.config.sleep_timer_enabled_flags(-2&self.config.sleep_timer_enabled_flags())}}),self.sleepTimerNotConnectedMinutes=ko.computed({read:function(){return Math.floor(self.config.sleep_timer_not_connected()/60)},write:function write(val){self.config.sleep_timer_not_connected(60*eval(val)+eval(self.sleepTimerNotConnectedSeconds()))}}),self.sleepTimerNotConnectedSeconds=ko.computed({read:function(){return self.config.sleep_timer_not_connected()%60},write:function write(val){self.config.sleep_timer_not_connected(60*eval(self.sleepTimerNotConnectedMinutes())+eval(val))}}),self.sleepTimerConnectedEnabled=ko.computed({read:function(){return 2==(2&self.config.sleep_timer_enabled_flags())},write:function(e){e?self.config.sleep_timer_enabled_flags(2|self.config.sleep_timer_enabled_flags()):self.config.sleep_timer_enabled_flags(-3&self.config.sleep_timer_enabled_flags())}}),self.sleepTimerConnectedMinutes=ko.computed({read:function(){return Math.floor(self.config.sleep_timer_connected()/60)},write:function write(val){self.config.sleep_timer_connected(60*eval(val)+eval(self.sleepTimerConnectedSeconds()))}}),self.sleepTimerConnectedSeconds=ko.computed({read:function(){return self.config.sleep_timer_connected()%60},write:function write(val){self.config.sleep_timer_connected(60*eval(self.sleepTimerConnectedMinutes())+eval(val))}}),self.sleepTimerDisconnectedEnabled=ko.computed({read:function(){return 4==(4&self.config.sleep_timer_enabled_flags())},write:function(e){e?self.config.sleep_timer_enabled_flags(4|self.config.sleep_timer_enabled_flags()):self.config.sleep_timer_enabled_flags(-5&self.config.sleep_timer_enabled_flags())}}),self.sleepTimerDisconnectedMinutes=ko.computed({read:function(){return Math.floor(self.config.sleep_timer_disconnected()/60)},write:function write(val){self.config.sleep_timer_disconnected(60*eval(val)+eval(self.sleepTimerDisconnectedSeconds()))}}),self.sleepTimerDisconnectedSeconds=ko.computed({read:function(){return self.config.sleep_timer_disconnected()%60},write:function write(val){self.config.sleep_timer_disconnected(60*eval(self.sleepTimerDisconnectedMinutes())+eval(val))}}),self.waitForRFID=function(){this.rfid.startWaiting(),console.log(\"Waiting for RFID\");function e(){self.rfid.poll(),self.rfid.waiting()?setTimeout(e,1e3):self.config.update()}setTimeout(e,1e3)};var updateTimer=null,updateTime=5e3,scanTimer=null,scanTime=3e3;self.status.time.subscribe(function(e){self.openevse.time.timeUpdate(new Date(e))}),self.timeSource=ko.computed({read:function(){return self.config.sntp_enabled()?\"ntp\":self.openevse.time.automaticTime()?\"browser\":\"manual\"},write:function(e){switch(e){case\"ntp\":self.config.sntp_enabled(!0),self.openevse.time.automaticTime(!0);break;case\"browser\":self.config.sntp_enabled(!1),self.openevse.time.automaticTime(!0);break;case\"manual\":self.config.sntp_enabled(!1),self.openevse.time.automaticTime(!1)}}}),self.time_zone=ko.computed({read:function(){return self.config.time_zone()},write:function(e){void 0!==e&&!1===self.zones.fetching()&&self.config.time_zone(e)}});var tab=\"status\";function split_emoncms_server(){var e=self.config.emoncms_server().split(\"://\",2);return 1<e.length?e:[self.config.http_supported_protocols()[0],e[0]]}\"\"!==window.location.hash&&(tab=window.location.hash.substr(1)),self.tab=ko.observable(tab),self.tab.subscribe(function(e){window.location.hash=\"#\"+e}),self.isSystem=ko.pureComputed(function(){return\"system\"===self.tab()}),self.isServices=ko.pureComputed(function(){return\"services\"===self.tab()}),self.isStatus=ko.pureComputed(function(){return\"status\"===self.tab()}),self.isRapi=ko.pureComputed(function(){return\"rapi\"===self.tab()}),self.upgradeUrl=ko.observable(\"about:blank\"),self.wifiPassword=new PasswordViewModel(self.config.pass),self.emoncmsApiKey=new PasswordViewModel(self.config.emoncms_apikey),self.mqttPassword=new PasswordViewModel(self.config.mqtt_pass),self.wwwPassword=new PasswordViewModel(self.config.www_password),self.emoncms_protocol=ko.computed({read:function(){return 0==self.config.http_supported_protocols().length?\"\":split_emoncms_server()[0]},write:function(e){0<self.config.http_supported_protocols().length&&self.config.emoncms_server(e+\"://\"+split_emoncms_server()[1])}}),self.emoncms_server=ko.computed({read:function(){return 0==self.config.http_supported_protocols().length?self.config.emoncms_server():split_emoncms_server()[1]},write:function(e){var n,t;0<self.config.http_supported_protocols().length?(n=(1<(t=e.split(\"://\",2)).length?t:split_emoncms_server())[0],t=1<t.length?t[1]:e,self.config.emoncms_server(n+\"://\"+t)):self.config.emoncms_server(e)}}),self.config.mqtt_protocol.subscribe(function(e){switch(e){case\"mqtt\":\"8883\"==self.config.mqtt_port()&&self.config.mqtt_port(\"1883\");break;case\"mqtts\":\"1883\"==self.config.mqtt_port()&&self.config.mqtt_port(\"8883\")}}),self.loadedCount=ko.observable(0),self.itemsLoaded=ko.pureComputed(function(){return self.loadedCount()+self.openevse.updateCount()}),self.itemsTotal=ko.observable(2+self.openevse.updateTotal()),self.start=function(){self.updating(!0),self.status.update(function(){self.loadedCount(self.loadedCount()+1),self.config.update(function(){self.loadedCount(self.loadedCount()+1),self.baseHost().endsWith(\".local\")&&\"\"!==self.status.ipaddress()&&(\"\"===self.config.www_username()?self.baseHost(self.status.ipaddress()):window.location.replace(\"http://\"+self.status.ipaddress()+\":\"+self.basePort())),self.status.rapi_connected()?self.openevse.update(self.finishedStarting):(self.finishedStarting(),self.status.rapi_connected.subscribe(function(e){e&&self.config.update(function(){self.openevse.update(function(){})})}))}),self.connect()}),self.advancedMode(\"true\"===self.getCookie(\"advancedMode\",\"false\")),self.developerMode(\"true\"===self.getCookie(\"developerMode\",\"false\"))},self.finishedStarting=function(){self.initialised(!0),updateTimer=setTimeout(self.update,updateTime),self.upgradeUrl(self.baseEndpoint()+\"/update\");for(var e=document.getElementsByTagName(\"img\"),n=0;n<e.length;n++)e[n].getAttribute(\"data-src\")&&e[n].setAttribute(\"src\",e[n].getAttribute(\"data-src\"));!1!==self.config.time_zone()&&(self.zones.initialValue(self.config.time_zone()),self.zones.update(function(){self.config.time_zone.valueHasMutated()})),self.updating(!1)},self.update=function(){self.updating()||(self.updating(!0),null!==updateTimer&&(clearTimeout(updateTimer),updateTimer=null),self.status.update(function(){updateTimer=setTimeout(self.update,updateTime),self.updating(!1)}))};var scanEnabled=!1;self.startScan=function(){self.scanUpdating()||(scanEnabled=!0,self.scanUpdating(!0),null!==scanTimer&&(clearTimeout(scanTimer),scanTimer=null),self.scan.update(function(){scanEnabled&&(scanTimer=setTimeout(self.startScan,scanTime)),self.scanUpdating(!1)}))},self.stopScan=function(){scanEnabled=!1,self.scanUpdating()||null!==scanTimer&&(clearTimeout(scanTimer),scanTimer=null)},self.wifiConnecting=ko.observable(!1),self.status.mode.subscribe(function(e){\"STA+AP\"!==e&&\"STA\"!==e||self.wifiConnecting(!1),\"STA+AP\"===e||\"AP\"===e?self.startScan():self.stopScan()}),self.saveNetworkFetching=ko.observable(!1),self.saveNetworkSuccess=ko.observable(!1),self.saveNetwork=function(){\"\"===self.config.ssid()?alert(\"Please select network\"):(self.saveNetworkFetching(!0),self.saveNetworkSuccess(!1),$.post(self.baseEndpoint()+\"/savenetwork\",{ssid:self.config.ssid(),pass:self.config.pass()},function(){self.saveNetworkSuccess(!0),self.wifiConnecting(!0)}).fail(function(){alert(\"Failed to save WiFi config\")}).always(function(){self.saveNetworkFetching(!1)}))},self.saveAdminFetching=ko.observable(!1),self.saveAdminSuccess=ko.observable(!1),self.saveAdmin=function(){self.saveAdminFetching(!0),self.saveAdminSuccess(!1),$.post(self.baseEndpoint()+\"/saveadmin\",{user:self.config.www_username(),pass:self.config.www_password()},function(){self.saveAdminSuccess(!0)}).fail(function(){alert(\"Failed to save Admin config\")}).always(function(){self.saveAdminFetching(!1)})},self.advancedGroup=new ConfigGroupViewModel(self.baseEndpoint,function(){return{hostname:self.config.hostname(),sntp_hostname:self.config.sntp_hostname()}}).done(function(){confirm(\"These changes require a reboot to take effect. Reboot now?\")&&$.post(self.baseEndpoint()+\"/restart\",{},function(){setTimeout(function(){var e=\"http://\"+self.config.hostname()+\".local\";80!=self.basePort()&&(e+=\":\"+self.basePort()),e+=\"/\",window.location.replace(e)},5e3)}).fail(function(){alert(\"Failed to restart\")})}),self.addRFIDTag=function(e){var n=self.config.rfid_storage();n&&n.includes(e)||(e=n+(\"\"==n?\"\":\",\")+e,self.config.rfid_storage(e)),self.rfid.scanned(\"\"),self.rfidGroup.save()},self.removeRFIDTag=function(e){confirm(\"You are about to remove the tag with UID: '\".concat(e,\"' permanently!\"))&&(e=new RegExp(\"\".concat(e,\",?\"),\"g\"),self.config.rfid_storage(self.config.rfid_storage().replaceAll(e,\"\")),self.rfid.scanned(\"\"),self.rfidGroup.save())},self.clearRFIDTags=function(){confirm(\"You are about to remove all stored tags permanently!\")&&(self.config.rfid_storage(\"\"),self.rfidGroup.save())},self.rfidGroup=new ConfigGroupViewModel(self.baseEndpoint,function(){return{rfid_enabled:self.config.rfid_enabled(),rfid_storage:self.config.rfid_storage()}}).done(function(){setTimeout(self.config.update(),1e3)}),self.config.rfid_enabled.subscribe(function(){self.rfidGroup.save()}),self.sleepTimerGroup=new ConfigGroupViewModel(self.baseEndpoint,function(){return{sleep_timer_enabled_flags:self.config.sleep_timer_enabled_flags(),sleep_timer_not_connected:self.config.sleep_timer_not_connected(),sleep_timer_connected:self.config.sleep_timer_connected(),sleep_timer_disconnected:self.config.sleep_timer_disconnected()}}),self.loadBalancingGroup=new ConfigGroupViewModel(self.baseEndpoint,function(){return{load_balancing_enabled:self.config.load_balancing_enabled(),safe_current_level:self.config.safe_current_level(),total_current:self.config.total_current(),load_balancing_topics:self.config.load_balancing_topics()}}),self.saveEmonCmsFetching=ko.observable(!1),self.saveEmonCmsSuccess=ko.observable(!1),self.saveEmonCms=function(){var e={enable:self.config.emoncms_enabled(),server:self.config.emoncms_server(),apikey:self.config.emoncms_apikey(),node:self.config.emoncms_node(),fingerprint:self.config.emoncms_fingerprint()};!e.enable||\"\"!==e.server&&\"\"!==e.node?e.enable&&32!==e.apikey.length&&!self.emoncmsApiKey.isDummy()?alert(\"Please enter valid Emoncms apikey\"):e.enable&&\"\"!==e.fingerprint&&59!==e.fingerprint.length?alert(\"Please enter valid SSL SHA-1 fingerprint\"):(self.saveEmonCmsFetching(!0),self.saveEmonCmsSuccess(!1),$.post(self.baseEndpoint()+\"/saveemoncms\",e,function(){self.saveEmonCmsSuccess(!0)}).fail(function(){alert(\"Failed to save Admin config\")}).always(function(){self.saveEmonCmsFetching(!1)})):alert(\"Please enter Emoncms server and node\")},self.mqttGroup=new ConfigGroupViewModel(self.baseEndpoint,function(){return{mqtt_enabled:self.config.mqtt_enabled(),divert_enabled:self.config.divert_enabled(),mqtt_protocol:self.config.mqtt_protocol(),mqtt_server:self.config.mqtt_server(),mqtt_port:self.config.mqtt_port(),mqtt_reject_unauthorized:self.config.mqtt_reject_unauthorized(),mqtt_topic:self.config.mqtt_topic(),mqtt_user:self.config.mqtt_user(),mqtt_pass:self.config.mqtt_pass(),mqtt_vrms:self.config.mqtt_vrms()}}).validate(function(e){return self.config.mqtt_enabled()||self.config.divert_enabled(!1),!e.mqtt_enabled||\"\"!==e.mqtt_server||(alert(\"Please enter MQTT server\"),!1)}),self.vehicleGroup=new ConfigGroupViewModel(self.baseEndpoint,function(){return{pause_uses_disabled:self.config.pause_uses_disabled()}}),self.config.pause_uses_disabled.subscribe(function(){self.vehicleGroup.save()}),self.divertGroup=new ConfigGroupViewModel(self.baseEndpoint,function(){return{divert_enabled:self.config.divert_enabled(),mqtt_solar:self.config.mqtt_solar(),mqtt_grid_ie:self.config.mqtt_grid_ie(),divert_PV_ratio:self.config.divert_PV_ratio(),divert_attack_smoothing_factor:self.config.divert_attack_smoothing_factor(),divert_decay_smoothing_factor:self.config.divert_decay_smoothing_factor(),divert_min_charge_time:self.config.divert_min_charge_time()}}).validate(function(e){return!e.divert_enabled||\"\"!==e.mqtt_solar||\"\"!==e.mqtt_grid_ie||(alert(\"Please enter either a Solar PV or Grid I/E feed\"),!1)}),self.chargeMode=new ConfigGroupViewModel(self.baseEndpoint,function(){return{charge_mode:self.config.charge_mode()}}),self.isEcoModeAvailable=ko.pureComputed(function(){return self.config.mqtt_enabled()&&(\"\"!==self.config.mqtt_solar()||\"\"!==self.config.mqtt_grid_ie())}),self.ecoMode=ko.pureComputed({read:function(){return\"eco\"===self.config.charge_mode()},write:function(e){self.config.charge_mode(e&&self.config.divert_enabled()?\"eco\":\"fast\"),self.chargeMode.save()}}),self.status.divertmode.subscribe(function(e){switch(e){case 1:self.config.charge_mode(\"fast\");break;case 2:self.config.charge_mode(\"eco\")}}),self.haveSolar=ko.pureComputed(function(){return\"\"!==self.config.mqtt_solar()}),self.haveGridIe=ko.pureComputed(function(){return\"\"!==self.config.mqtt_grid_ie()}),self._divertFeedType=\"grid_ie\",self.divertFeedType=ko.computed({read:function(){var e=self.haveSolar()?\"solar\":self.haveGridIe()?\"grid_ie\":self._divertFeedType;return self._divertFeedType=e},write:function(e){\"solar\"===e&&self.haveGridIe()?(self.config.mqtt_solar(self.config.mqtt_grid_ie()),self.config.mqtt_grid_ie(\"\")):\"grid_ie\"===e&&self.haveSolar()&&(self.config.mqtt_grid_ie(self.config.mqtt_solar()),self.config.mqtt_solar(\"\")),self._divertFeedType=e}}),self.divertFeedValue=ko.computed({read:function(){return\"solar\"===self.divertFeedType()?self.config.mqtt_solar():self.config.mqtt_grid_ie()},write:function(e){\"solar\"===self.divertFeedType()?self.config.mqtt_solar(e):self.config.mqtt_grid_ie(e)}}),self.saveOhmKeyFetching=ko.observable(!1),self.saveOhmKeySuccess=ko.observable(!1),self.saveOhmKey=function(){self.saveOhmKeyFetching(!0),self.saveOhmKeySuccess(!1),$.post(self.baseEndpoint()+\"/saveohmkey\",{enable:self.config.ohm_enabled(),ohm:self.config.ohmkey()},function(){self.saveOhmKeySuccess(!0)}).fail(function(){alert(\"Failed to save Ohm key config\")}).always(function(){self.saveOhmKeyFetching(!1)})},self.setTimeFetching=ko.observable(!1),self.setTimeSuccess=ko.observable(!1),self.setTime=function(){self.setTimeFetching(!0),self.setTimeSuccess(!1);var e,n,t=self.openevse.time.automaticTime()?new Date:self.openevse.time.evseTimedate();0==self.status.time()?self.openevse.openevse.time(function(e){var n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];self.setTimeFetching(!1),self.setTimeSuccess(n),self.openevse.time.timeUpdate(e,n)},t):(!(n={ntp:e=self.config.sntp_enabled(),tz:self.time_zone()})===e&&(n.time=t.toISOString()),$.post(self.baseEndpoint()+\"/settime\",n,function(){self.setTimeFetching(!1),self.setTimeSuccess(!0)}).fail(function(){alert(\"Failed to set time\"),self.setTimeFetching(!1)}))},self.turnOffAccessPointFetching=ko.observable(!1),self.turnOffAccessPointSuccess=ko.observable(!1),self.turnOffAccessPoint=function(){self.turnOffAccessPointFetching(!0),self.turnOffAccessPointSuccess(!1),$.post(self.baseEndpoint()+\"/apoff\",{},function(e){console.log(e),\"\"!==self.status.ipaddress()?setTimeout(function(){window.location=\"http://\"+self.status.ipaddress(),self.turnOffAccessPointSuccess(!0)},3e3):self.turnOffAccessPointSuccess(!0)}).fail(function(){alert(\"Failed to turn off Access Point\")}).always(function(){self.turnOffAccessPointFetching(!1)})},self.factoryResetFetching=ko.observable(!1),self.factoryResetSuccess=ko.observable(!1),self.factoryReset=function(){confirm(\"CAUTION: Do you really want to Factory Reset? All setting and config will be lost.\")&&(self.factoryResetFetching(!0),self.factoryResetSuccess(!1),$.post(self.baseEndpoint()+\"/reset\",{},function(){self.factoryResetSuccess(!0)}).fail(function(){alert(\"Failed to Factory Reset\")}).always(function(){self.factoryResetFetching(!1)}))},self.restartFetching=ko.observable(!1),self.restartSuccess=ko.observable(!1),self.restart=function(){confirm(\"Restart OpenEVSE WiFi? Current config will be saved, takes approximately 10s.\")&&(self.restartFetching(!0),self.restartSuccess(!1),$.post(self.baseEndpoint()+\"/restart\",{},function(){self.restartSuccess(!0)}).fail(function(){alert(\"Failed to restart\")}).always(function(){self.restartFetching(!1)}))},self.updateFetching=ko.observable(!1),self.updateComplete=ko.observable(!1),self.updateError=ko.observable(\"\"),self.updateFilename=ko.observable(\"\"),self.updateLoaded=ko.observable(0),self.updateTotal=ko.observable(1),self.updateProgress=ko.pureComputed(function(){return self.updateLoaded()/self.updateTotal()*100}),self.otaUpdate=function(){var e;\"\"!==self.updateFilename()?(self.updateFetching(!0),self.updateError(\"\"),e=$(\"#upload_form\")[0],e=new FormData(e),$.ajax({url:\"/update\",type:\"POST\",data:e,contentType:!1,processData:!1,xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener(\"progress\",function(e){e.lengthComputable&&(self.updateLoaded(e.loaded),self.updateTotal(e.total))},!1),e}}).done(function(e){console.log(e),\"OK\"==e?self.updateComplete(!0):self.updateError(e)}).fail(function(){self.updateError(\"HTTP Update failed\")}).always(function(){self.updateFetching(!1)})):self.updateError(\"Filename not set\")},self.pingInterval=!1,self.reconnectInterval=!1,self.socket=!1,self.connect=function(){self.socket=new WebSocket(self.wsEndpoint()),self.socket.onopen=function(e){console.log(e),self.pingInterval=setInterval(function(){self.socket.send('{\"ping\":1}')},1e3)},self.socket.onclose=function(e){console.log(e),self.reconnect()},self.socket.onmessage=function(e){console.log(e),ko.mapping.fromJSON(e.data,self.status)},self.socket.onerror=function(e){console.log(e),self.socket.close(),self.reconnect()}},self.reconnect=function(){!1!==self.pingInterval&&(clearInterval(self.pingInterval),self.pingInterval=!1),!1===self.reconnectInterval&&(self.reconnectInterval=setTimeout(function(){self.reconnectInterval=!1,self.connect()},500))},self.setCookie=function(e,n){var t,s=2<arguments.length&&void 0!==arguments[2]&&arguments[2],o=\"\";!1!==s&&((t=new Date).setTime(t.getTime()+24*s*60*60*1e3),o=\";expires=\"+t.toUTCString()),document.cookie=e+\"=\"+n+o+\";path=/\"},self.getCookie=function(e){for(var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:\"\",t=e+\"=\",s=document.cookie.split(\";\"),o=0;o<s.length;o++){for(var r=s[o];\" \"===r.charAt(0);)r=r.substring(1);if(0===r.indexOf(t))return r.substring(t.length,r.length)}return n}}function scaleString(e,n,t){return((\"number\"==typeof e?e:parseInt(e))/n).toFixed(t)}function formatUpdate(e){if(!1===e)return\"N/A\";var n=e/60,t=e/3600,s=t/24,o=e.toFixed(0)+\"s\";return 0===e.toFixed(0)?o=\"now\":7<s?o=\"inactive\":2<s?o=s.toFixed(1)+\" days\":2<t?o=t.toFixed(0)+\" hrs\":180<e&&(o=n.toFixed(0)+\" mins\"),o}function updateClass(e){if(!1===e)return\"\";var n=\"updateBad\";return(e=Math.abs(e))<25?n=\"updateGood\":e<60?n=\"updateSlow\":e<7200&&(n=\"updateSlower\"),n}!function(){var n=window.location.hostname,t=window.location.port,s=window.location.protocol;$(function(){var e=new OpenEvseWiFiViewModel(n,t,s);ko.applyBindings(e),e.start()})}();\n"
  "//# sourceMappingURL=home.js.map\n";
